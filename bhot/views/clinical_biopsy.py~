from flask import render_template, flash, redirect, url_for

from bhot import app,csrf
from bhot.models import db
from bhot.models.clinical_biopsy import ClinicalBiopsy
from bhot.forms.clinical_biopsy import ClinicalBiopsyForm

@app.route("/clinical-biopsy/add", methods=["GET","POST"])
def clinical_biopsy_add():
    f = ClinicalBiopsyForm()
    if f.validate_on_submit():
        r = ClinicalBiopsy()
        f.copy_to_db_model(r)
        db.session.add(r)
        db.session.commit()
        flash('New ClinicalBiopsy Added','success')
        return redirect(url_for("clinical_biopsy_list"))
    return render_template("clinical-biopsy.html", form=f)


@app.route("/clinical-biopsy/edit/<id>", methods=["GET","POST"])
def clinical_biopsy_edit(id):
    r = ClinicalBiopsy.query.filter_by(clinical_biopsy_id=id).first()
    if not r:
        #TODO: Log
        abort(400)

    f = ClinicalBiopsyForm()

    if f.validate_on_submit():
        f.copy_to_db_model(r)
        db.session.add(r)
        db.session.commit()
        flash('ClinicalBiopsy Updated','success')
        return redirect("/")
    else:
        f.copy_from_db_model(r)

    return render_template("clinical-biopsy.html", form=f)


@app.route("/clinical-biopsy/list")
def clinical_biopsy_list():
    r = ClinicalBiopsy.query.all()
    return render_template("clinical-biopsy-list.html", clinical_biopsiess=r)
